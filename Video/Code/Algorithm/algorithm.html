<!DOCTYPE html>
<html>
<head><title>Algorithm Test</title>

<body>
	<center>
<h1> Recommendation Engine </h1>
<p> Click to get a SOC </p> 

<table>
<tr>
<td><button type="button" onclick="addWeight(11)">+11</button> </td>
<td><button type="button" onclick="addWeight(13)">+13</button> </td>
<td><button type="button" onclick="addWeight(15)">+15</button> </td>
<td><button type="button" onclick="addWeight(17)">+17</button> </td>
<td><button type="button" onclick="addWeight(19)">+19</button> </td>
<td><button type="button" onclick="addWeight(21)">+21</button> </td>
<td>Total</td>
</tr>

<tr>
<td id='w11'>0</td>
<td id='w13'>0</td>
<td id='w15'>0</td>
<td id='w17'>0</td>
<td id='w19'>0</td>
<td id='w21'>0</td>
<td id='wtotal'>0</td>
</tr>


</table>
<button type="button" onclick="demoSOC()">Get SOC</button>
<p id="SOC"></p>

<script src="SOC.js"></script>
<script> 

function addWeight(x){
	demoWeightedArray = demoWeightedArray.concat(x);
	var targetId = "w" + x;
	var count = Number(document.getElementById(targetId).innerHTML);
	document.getElementById(targetId).innerHTML = count + 1;

	document.getElementById('wtotal').innerHTML = computeTotal();
}

function computeTotal(){
	var count = 0
	for (var i = 11; i < 22; i+=2)
	{
		var targetId = "w" + i;
		count += Number(document.getElementById(targetId).innerHTML);
	}
	return count;
}

var majorGroupMap = {};
// maps soc into major groups
for (var i = 11; i < 56; i+=2)
{
	majorGroupMap[i] = SOC.filter(filterMajor(i));
}

// Hardcoding of Major and Minor group list
var mainGroupList = [11, 13, 15, 17, 19, 21, 23, 25, 27, 29]//, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53];
var mainGroupLength = mainGroupList.length;



var demoWeightedArray = mainGroupList;


function demoSOC(){
	// create weighted array based on the weight of the node
	// weighted by putting the heavier nodes more times in the lottery

	// select a random node in the index
	var index = Math.floor(Math.random()* demoWeightedArray.length);
	var majorGroupNum = demoWeightedArray[index];
	console.log(majorGroupNum)

	// get array of the group
	var socListInMajorGroup = majorGroupMap[majorGroupNum]; 
	var indexOccupation = Math.floor(Math.random()* socListInMajorGroup.length);
	var soc = socListInMajorGroup[indexOccupation];

	// Updates the HTML text with an SOC number
	document.getElementById("SOC").innerHTML += soc + "<br>";

}


var minorGroupList = {};
minorGroupList[11] = ['1', '2', '3', '9']
minorGroupList[13] = [1, 2]
minorGroupList[15] = [1, 2]
minorGroupList[17] = [1, 2, 3]
minorGroupList[19] = [1, 2, 3, 4]
minorGroupList[21] = [1, 2]
minorGroupList[23] = [1, 2]
minorGroupList[25] = [1, 2, 3, 4, 9]
minorGroupList[27] = [1, 2, 3, 4]
minorGroupList[29] = [1, 2, 9]
minorGroupList[31] = [1, 2, 9]
minorGroupList[33] = [1, 2, 3, 9]
minorGroupList[35] = [1, 2, 3, 9]
minorGroupList[37] = [1, 2, 3]
minorGroupList[39] = [1, 2, 3, 4, 5, 6, 7, 9]
minorGroupList[41] = [1, 2, 3, 4, 9]
minorGroupList[43] = [1, 2, 3, 4, 5, 6, 9]
minorGroupList[45] = [1, 2, 3, 4]
minorGroupList[47] = [1, 2, 3, 4, 5]
minorGroupList[49] = [1, 2, 3, 9]
minorGroupList[51] = [1, 2, 3, 4, 5, 6, 7, 8, 9]
minorGroupList[53] = [1, 2, 3, 4, 5, 6, 7]
minorGroupList[55] = [1, 2, 3]

var majorMinor = {}

majorMinor[111] = ["011", "021", "031"];
majorMinor[112] = ['011', "021", "022", "031"];
majorMinor[113] = ["011", "021", "031", "051", "061", "071", "111", "121", "131"];
majorMinor[119] = ["013", "021", "031", "032", "033", "039", "041", "051", "061", "071", "081", "111", "121", "131", "141", "151", "161", "199"];


majorMinor[131] = ["011", "021", "022", "023", "031", "032", "041", "051", "071", "074", "075", "081", "111", "121", "131", "141", "151", "161", "199"];
majorMinor[132] = ["011", "021", "031", "041", "051", "052", "053", "061", "071", "072", "081", "082", "099"];


var root = {name: "Root",
			type: "Root",
			child: {}
}

// Creats node
// each node has name, type, weight and child
// child is a dictionary of nodes. Use for (var child in node.child) to loop
function createNode(num, type, weight, child){
	return 	{name: num, 
				type: type,
				weight: weight,
				child: child}
}


// contruct tree
function buildTree(){
	
	// add child to root
	for (var i in mainGroupList)
	{
		var mainGroupNum = mainGroupList[i];
		var newNode = createNode(mainGroupNum, "MainGroup", 1, {});

		root.child[mainGroupNum] = newNode;
	}

	// add child to major groups
	for (var key in root.child)
	{
		var node = root.child[key];
		var majorGroupNum = Number(node.name)
		//console.log(majorGroupNum);
		for (var k in minorGroupList[majorGroupNum])
		{
			var minorNum = minorGroupList[majorGroupNum][k]
			root.child[majorGroupNum].child[minorNum] = createNode(minorNum , "MinorGroup", 1, {});
		}
	}

	// add child to minor groups
	for (var majorNum in root.child)
	{
		majorNode = root.child[majorNum];
		//console.log(minorGroupList[majorNum]);
		for (var minorNum in majorNode.child)
		{
			var minorNode = majorNode.child[minorNum];

			var combine = Number(majorNum + "" + minorNum);
			//console.log(combine);
			var occuplist = majorMinor[combine]
			//console.log(occuplist);

			for (var occupNumIndex in occuplist)
			{
				occupNum = occuplist[occupNumIndex];
				//console.log(majorNum + " " + minorNum + " " + occupNum);

				minorNode.child[Number(occupNum)] = createNode(""+occupNum , "Occupation", 1, {});
			}	
		}
	}

}


// builds tree
buildTree();



function getMainGroup(preference){
	var mainGroupArray = []

	// pushes all child of root into an array
	for (var c in root.child)
		mainGroupArray.push(root.child[c]);
	
	// create weighted array based on the weight of the node
	// weighted by putting the heavier nodes more times in the lottery
	var weightedArray = []
	var scaleInt = 100
	for (var i = 0; i < mainGroupArray.length; i++)
	{
		var node = mainGroupArray[i];
		var weight = Math.floor(node.weight * scaleInt);
		for (var j = 0; j < weight; j++)
			weightedArray.push(node.name);
	}

	// select a random node in the index
	var index = Math.floor(Math.random()* weightedArray.length);
	var numSelected = weightedArray[index];
	var mainGroupNum = root.child[numSelected].name;

	// Haha, we only got 11 and 13 coded right now, need to implement build tree via database to get all the data.
	mainGroupNum = 11 + Math.floor(Math.random()*2)*2;

	var minorNum = getMinorGroup(mainGroupNum);
	var occupationNum = getOccupation(mainGroupNum, minorNum)


	// Updates the HTML text with an SOC number
	document.getElementById("SOC").innerHTML += mainGroupNum + "-" + minorNum + " " + occupationNum + "<br>";

}


// same as major group
function getMinorGroup(majorGroup, preference){
	var minorGroupArray = []
	baseNode = root.child[majorGroup];
	for (var c in baseNode.child)
		minorGroupArray.push(baseNode.child[c]);
	
	var weightedArray = []
	var scaleInt = 100
	for (var i = 0; i < minorGroupArray.length; i++)
	{
		var node = minorGroupArray[i];
		var weight = Math.floor(node.weight * scaleInt);
		for (var j = 0; j < weight; j++)
			weightedArray.push(node.name);
	}

	//console.log(weightedArray);
	var index = Math.floor(Math.random()* weightedArray.length);
	var numSelected = weightedArray[index];

	var minorGroupNum = baseNode.child[numSelected].name;
	
	return minorGroupNum;
}


// same as major group
function getOccupation(majorGroup, minorGroup){
	var occupationArray = []
	baseNode = root.child[majorGroup].child[minorGroup];
	for (var c in baseNode.child)
		occupationArray.push(baseNode.child[c]);
	
	var weightedArray = []
	var scaleInt = 100
	for (var i = 0; i < occupationArray.length; i++)
	{
		var node = occupationArray[i];
		var weight = Math.floor(node.weight * scaleInt);
		for (var j = 0; j < weight; j++)
			weightedArray.push(node.name);
	}

	var index = Math.floor(Math.random()* weightedArray.length);
	var numSelected = weightedArray[index];

	//console.log(majorGroup + " " + minorGroup + " " + numSelected);
	var occupationNum = baseNode.child[Number(numSelected)].name;
	
	return occupationNum;
}

</script>



</body>


</html>